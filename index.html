<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Distrito Imports | Gestão Total</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root{ --red:#E60000; --black:#0a0a0a; --gray:#f2f2f2; --whats:#25D366; --yellow:#FFD700; --dark-gray:#333; }
        body{margin:0;font-family:'Montserrat',sans-serif;background:var(--gray);padding-bottom:120px;color:var(--black);overflow-x:hidden;}
        
        /* BLOQUEIO DISCRETO */
        #tela-bloqueio { position: fixed; inset: 0; background: var(--black); z-index: 50000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #logo-tranca { font-weight: 900; color:white; cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent;}
        #logo-tranca span { color: var(--red); }
        .input-secreta { display: none; background: transparent; border: none; border-bottom: 2px solid #333; color: white; padding: 10px; width: 150px; text-align: center; font-size: 20px; outline: none; margin-top: 30px; }

        header{background:var(--black);color:#fff;text-align:center;padding:20px;border-bottom:4px solid var(--red);cursor:pointer;}
        header h1{margin:0; font-size:18px; text-transform:uppercase; font-weight:900;}
        header span{color:var(--red)}

        #banner-topo img { width: 100%; display: block; }
        .search-box { padding: 10px; background: #fff; display: flex; justify-content: center; position: sticky; top: 0; z-index: 1100; }
        #searchBar { width: 90%; padding: 12px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-family: Montserrat; }

        nav{background:#fff;display:flex;justify-content:flex-start;position:sticky;top:54px;z-index:1000;box-shadow:0 2px 5px rgba(0,0,0,0.1);overflow-x:auto; scrollbar-width: none;}
        .nav-link{padding:15px 20px;border:none;background:none;font-weight:700;font-size:11px;text-transform:uppercase;cursor:pointer;white-space:nowrap;color:#666;}
        .nav-link.active{color:var(--red);border-bottom:3px solid var(--red)}

        .grid{display:grid;grid-template-columns:repeat(2, 1fr);gap:10px;padding:10px;}
        .card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.1);display:flex;flex-direction:column;position:relative;}
        .img-box{width:100%;padding-top:130%;position:relative;background:#eee;}
        .img-box img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;}
        
        .tag-prod { position: absolute; top: 8px; left: 8px; background: var(--red); color: #fff; font-size: 8px; padding: 4px 8px; border-radius: 4px; font-weight: 900; z-index: 5; text-transform: uppercase; }
        .price{color:var(--red);font-weight:900;font-size:18px;margin-bottom:10px; text-align:center;}
        .sizes{display:flex;justify-content:center;gap:4px;margin-bottom:12px;flex-wrap:wrap; padding: 0 5px;}
        .size{border:1px solid #ddd;padding:6px 8px;font-size:10px;border-radius:4px;cursor:pointer;font-weight:bold;}
        .size.active{background:var(--red);color:#fff;border-color:var(--red);}
        .size.out { opacity: 0.15; text-decoration: line-through; pointer-events: none; }
        .btn-buy{background:var(--whats);color:#fff;border:none;width:100%;padding:14px;font-weight:900;font-size:10px;cursor:pointer;text-transform:uppercase;}

        /* CARRINHO */
        #cart-bar{position:fixed;bottom:0;width:100%;background:var(--black);color:#fff;padding:15px;display:none;justify-content:space-around;align-items:center;z-index:2000;border-top:4px solid var(--red);}
        #modal-carrinho { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:10000; align-items:center; justify-content:center; padding:15px; }
        .cart-content { background:#fff; padding:20px; border-radius:15px; width:100%; max-width:400px; color:#333; max-height: 85vh; overflow-y: auto; }

        /* ADMIN */
        #adminPanel{display:none;position:fixed;inset:0;background:var(--black);z-index:60000;overflow:auto;color:#fff;}
        .config-card { background: white; border-radius: 15px; margin: 15px; padding: 20px; color: #333; }
        .admin-input-card { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 8px; margin-top: 5px; box-sizing: border-box; font-family: Montserrat; margin-bottom: 10px; font-weight: 700; }
        .btn-acao { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: 900; margin-top: 10px; text-transform: uppercase; cursor:pointer;}
        .btn-yellow { background: var(--yellow); color: black; }
        .grade-input { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
    </style>
</head>
<body>

<div id="tela-bloqueio">
    <h1 id="logo-tranca" onclick="tCli++">DISTRITO <span>IMPORTS</span></h1>
    <input type="password" id="passInput" class="input-secreta" oninput="checarSenha(this.value)">
</div>

<header id="logo-admin"><h1>DISTRITO <span>IMPORTS</span></h1></header>
<div id="banner-topo"></div>
<div class="search-box"><input type="text" id="searchBar" placeholder="O que você busca?" onkeyup="filtrar()"></div>

<nav id="menu-categorias"></nav>
<div id="product-grid" class="grid"></div>

<div id="cart-bar">
    <span id="cart-count">0 ITENS</span>
    <button onclick="abrirCheckout()" style="background:var(--whats);color:#fff;border:none;padding:10px;border-radius:5px;font-weight:900;">FINALIZAR</button>
</div>

<div id="modal-carrinho">
    <div class="cart-content">
        <h3 style="text-align:center; color:var(--red)">DADOS DE ENTREGA</h3>
        <div id="lista-itens" style="margin-bottom:15px; border-bottom:1px solid #eee;"></div>
        <input type="text" id="cliNome" placeholder="Nome Completo" class="admin-input-card">
        <input type="text" id="cliBairro" placeholder="Bairro" class="admin-input-card">
        <input type="text" id="cliRua" placeholder="Rua" class="admin-input-card">
        <input type="text" id="cliNum" placeholder="Número da Casa" class="admin-input-card">
        <button onclick="enviarPedido()" class="btn-acao" style="background:var(--whats); color:white;">ENVIAR WHATSAPP</button>
        <button onclick="fecharCheckout()" style="width:100%; background:none; border:none; color:#999; margin-top:15px;">VOLTAR</button>
    </div>
</div>

<div id="adminPanel">
    <div style="padding:20px; display:flex; justify-content:space-between; align-items:center; background:#111;">
        <span style="font-weight:900;">PAINEL GESTÃO</span>
        <button onclick="closeAdmin()" style="background:var(--red); color:white; border:none; padding:8px 15px; border-radius:5px; font-weight:900;">SAIR</button>
    </div>

    <div class="config-card">
        <label style="font-weight:900; font-size:10px; color:red;">GERENCIAR CATEGORIAS</label>
        <div style="display:flex; gap:5px; margin-top:10px;">
            <input type="text" id="novaCatNome" placeholder="Ex: Relógios" class="admin-input-card" style="margin:0;">
            <button onclick="addCategoria()" style="background:black; color:white; border:none; padding:0 20px; border-radius:8px; font-weight:900;">[+]</button>
        </div>
        <div id="lista-cats-admin" style="margin-top:15px; display:flex; flex-wrap:wrap; gap:5px;"></div>
    </div>

    <div class="config-card">
        <label style="font-weight:900; font-size:10px;">CONFIGURAÇÕES</label>
        <input type="text" id="admZap" class="admin-input-card" placeholder="WhatsApp (55...)" onchange="config.zap=this.value;save()">
        <input type="text" id="admBanner" class="admin-input-card" placeholder="URL Imagem Banner" onchange="config.banner=this.value;save()">
        <button id="btn-lock" class="btn-acao" onclick="toggleMaster()"></button>
    </div>

    <div id="admin-list-prods" style="padding-bottom:100px;"></div>
    <button style="position:fixed; bottom:20px; right:20px; width:65px; height:65px; border-radius:50%; background:var(--whats); color:white; border:none; font-size:35px; box-shadow:0 5px 15px rgba(0,0,0,0.5);" onclick="addNovo()">+</button>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('DIST_MAX_DB')) || { Camisas: [] };
    let config = JSON.parse(localStorage.getItem('DIST_MAX_CF')) || { zap: "5522999400239", banner: "", master: true };
    let catAtual = Object.keys(db)[0];
    let carrinho = [];
    let tCli = 0; let aCli = 0;

    // MONITOR DE CLIQUES
    setInterval(() => {
        if(tCli >= 5) { document.getElementById('passInput').style.display = 'block'; document.getElementById('passInput').focus(); tCli = 0; }
        if(aCli >= 5) { if(prompt("SENHA ADMIN:") === "2123") openAdmin(); aCli = 0; }
    }, 1000);

    function checarSenha(v){ if(v === "2123") { document.getElementById('tela-bloqueio').style.display='none'; document.getElementById('passInput').value=''; } }
    document.getElementById('logo-admin').onclick = () => aCli++;

    function init(){
        if(!config.master) document.getElementById('tela-bloqueio').style.display = 'none';
        document.getElementById('admZap').value = config.zap;
        document.getElementById('admBanner').value = config.banner;
        renderMenu(); render(); updateBanner(); updateBtn();
    }

    function renderMenu(){
        const nav = document.getElementById('menu-categorias');
        nav.innerHTML = '';
        Object.keys(db).forEach(cat => {
            nav.innerHTML += `<button class="nav-link ${cat===catAtual?'active':''}" onclick="catAtual='${cat}';renderMenu();render();">${cat}</button>`;
        });
    }

    function render(){
        const grid = document.getElementById('product-grid');
        grid.innerHTML = '';
        (db[catAtual] || []).forEach((p, i) => {
            grid.innerHTML += `
                <div class="card">
                    ${p.tag?`<div class="tag-prod">${p.tag}</div>`:''}
                    <div class="img-box"><img src="${p.img || 'https://via.placeholder.com/400'}"></div>
                    <div class="info">
                        <h3 style="font-size:10px;">${p.nome}</h3>
                        <div class="price">R$ ${p.preco}</div>
                        <div class="sizes">${Object.entries(p.estoque).map(([t,q])=>`<div class="size ${q<=0?'out':''}" onclick="selTam(this,'${catAtual}',${i},'${t}')">${t}</div>`).join('')}</div>
                        <button class="btn-buy" id="bt-${i}" disabled>ESCOLHA O TAMANHO</button>
                    </div>
                </div>`;
        });
    }

    function selTam(el, cat, idx, tam){
        el.parentElement.querySelectorAll('.size').forEach(s => s.classList.remove('active'));
        el.classList.add('active');
        const btn = document.getElementById(`bt-${idx}`);
        btn.disabled = false; btn.innerText = "ADICIONAR";
        btn.onclick = () => {
            carrinho.push({n: db[cat][idx].nome, t: tam, p: db[cat][idx].preco});
            updateCar(); btn.innerText = "✅ OK!";
        };
    }

    function updateCar(){
        document.getElementById('cart-bar').style.display = carrinho.length > 0 ? 'flex' : 'none';
        document.getElementById('cart-count').innerText = carrinho.length + " ITENS";
    }

    function abrirCheckout(){
        document.getElementById('modal-carrinho').style.display = 'flex';
        const l = document.getElementById('lista-itens');
        l.innerHTML = '';
        carrinho.forEach((it, i) => {
            l.innerHTML += `<div style="display:flex; justify-content:space-between; padding:8px 0; font-size:11px;">
                <span>${it.n} (${it.t})</span><span style="color:red; font-weight:900;" onclick="carrinho.splice(${i},1);abrirCheckout();updateCar();">[X]</span></div>`;
        });
    }

    function enviarPedido(){
        const n=document.getElementById('cliNome').value, b=document.getElementById('cliBairro').value, r=document.getElementById('cliRua').value, num=document.getElementById('cliNum').value;
        if(!n||!b||!r||!num) return alert("Endereço Incompleto!");
        let m = `*PEDIDO DISTRITO*\n\n*CLIENTE:* ${n}\n*ENDEREÇO:* ${r}, ${num}\n*BAIRRO:* ${b}\n\n*ITENS:*\n`;
        carrinho.forEach(c => m += `• ${c.n} (${c.t})\n`);
        window.location.href = `https://wa.me/${config.zap}?text=${encodeURIComponent(m)}`;
    }

    function addCategoria(){
        const nome = document.getElementById('novaCatNome').value;
        if(!nome || db[nome]) return;
        db[nome] = []; save(); renderMenu(); openAdmin();
    }

    function openAdmin(){
        document.getElementById('adminPanel').style.display = 'block';
        const lCats = document.getElementById('lista-cats-admin');
        lCats.innerHTML = '';
        Object.keys(db).forEach(cat => {
            lCats.innerHTML += `<div style="background:#eee; padding:5px 10px; border-radius:5px; font-size:10px; font-weight:900;">${cat.toUpperCase()} <span onclick="if(confirm('Apagar categoria?')){delete db['${cat}'];save();openAdmin();renderMenu();}" style="color:red; margin-left:10px;">[X]</span></div>`;
        });

        const lProds = document.getElementById('admin-list-prods');
        lProds.innerHTML = `<h3 style="padding:15px; font-size:12px; color:var(--yellow)">PRODUTOS EM: ${catAtual.toUpperCase()}</h3>`;
        (db[catAtual] || []).forEach((p, i) => {
            let grade = '';
            Object.entries(p.estoque).forEach(([t, q]) => {
                grade += `<div><label style="font-size:8px;">${t}</label><input type="number" value="${q}" class="admin-input-card" style="padding:5px;" onchange="db['${catAtual}'][${i}].estoque['${t}']=Number(this.value);save()"></div>`;
            });
            lProds.innerHTML += `<div class="config-card">
                <input type="text" class="admin-input-card" value="${p.nome}" onchange="db['${catAtual}'][${i}].nome=this.value;save()">
                <div style="display:flex; gap:10px;"><input type="text" class="admin-input-card" value="${p.preco}" onchange="db['${catAtual}'][${i}].preco=this.value;save()"><input type="text" class="admin-input-card" value="${p.tag||''}" placeholder="Tag" onchange="db['${catAtual}'][${i}].tag=this.value;save()"></div>
                <input type="text" class="admin-input-card" value="${p.img}" onchange="db['${catAtual}'][${i}].img=this.value;save()">
                <div class="grade-input">${grade}</div>
                <button onclick="db['${catAtual}'].splice(${i},1);save();openAdmin();" style="color:red; background:none; border:none; width:100%; margin-top:10px; font-weight:900;">EXCLUIR</button>
            </div>`;
        });
    }

    function addNovo(){
        let g = (catAtual.toLowerCase().includes('tenis') || catAtual.toLowerCase().includes('bermuda')) ? {38:1,40:1,42:1,44:1,46:1,48:1} : {P:1,M:1,G:1,GG:1};
        db[catAtual].unshift({nome:"Novo Item", preco:"0,00", img:"", tag:"", estoque:g});
        save(); openAdmin();
    }

    function save(){ localStorage.setItem('DIST_MAX_DB', JSON.stringify(db)); localStorage.setItem('DIST_MAX_CF', JSON.stringify(config)); }
    function toggleMaster(){ config.master = !config.master; save(); updateBtn(); }
    function updateBtn(){ const b=document.getElementById('btn-lock'); b.innerText=config.master?"TRANCAR LOJA":"ABRIR LOJA"; b.style.background=config.master?"red":"green"; b.style.color="white";}
    function updateBanner(){ document.getElementById('banner-topo').innerHTML = config.banner ? `<img src="${config.banner}">` : ''; }
    function fecharCheckout(){ document.getElementById('modal-carrinho').style.display='none'; }
    function closeAdmin(){ document.getElementById('adminPanel').style.display='none'; render(); }
    function filtrar(){ let v=document.getElementById('searchBar').value.toLowerCase(); document.querySelectorAll('.card').forEach(c=>c.style.display=c.innerText.toLowerCase().includes(v)?'flex':'none');}

    init();
</script>
</body>
</html>
